<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>P2HD BLE Test</title>
</head>
<body>
  <button id="connect">Connect P2HD</button>
  <pre id="log"></pre>

<script>
const log = (m) => {
  document.getElementById('log').textContent += m + '\n';
};

// ⚠️ 這就是你截圖中的真正 Service UUID
const SERVICE_UUID = '0000fff0-c243-40b9-ac41-a10ba3ad5d1a';

let device, server;

document.getElementById('connect').addEventListener('click', async () => {
  try {
    log('Requesting device...');
    device = await navigator.bluetooth.requestDevice({
      acceptAllDevices: true,
      optionalServices: [SERVICE_UUID]
    });

    log('Selected: ' + (device.name || 'no name'));
    server = await device.gatt.connect();
    log('GATT connected');

    // ⭐ 直接抓這個 service（不再用 getPrimaryServices()）
    const service = await server.getPrimaryService(SERVICE_UUID);
    log('Service OK: ' + service.uuid);

    const chars = await service.getCharacteristics();
    log('Characteristics count: ' + chars.length);

    chars.forEach(ch => {
      const p = ch.properties;
      log(
        `Char ${ch.uuid} | ` +
        `write=${p.write} ` +
        `writeNR=${p.writeWithoutResponse} ` +
        `notify=${p.notify} ` +
        `read=${p.read}`
      );
    });

  } catch (e) {
    log('ERROR: ' + e.message);
  }
});
</script>
</body>
</html>
